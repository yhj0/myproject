<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="member">
<!--회원정보 조회 -->
    <select id="selectMemberOne" parameterType="String"  resultType="gu.member.MemberVO" >
		SELECT  A.NAME AS NAME,
	            A.ID AS ID,
	            A.EMAIL AS EMAIL,
	            A.REG_DTTM AS REG_DTTM,
	            A.PASSWORD,
	            A.NICK_NAME,
	            B.FILENAME AS FILENAME,
	            B.REG_DTTM AS FILE_DTTM
		  FROM TBL_MEMBER A, TBL_IMAGE B 
	     WHERE 1=1
		   AND A.ID = B.REG_ID 
		   AND B.REG_DTTM = (SELECT MAX(REG_DTTM) 
			  	 			   FROM TBL_IMAGE
			  	 			  WHERE 1=1 
			  	 			    AND REG_ID = #{id} )
	       AND A.ID = #{id} 
    </select> 

<!--회원정보 입력 -->
    <insert id="insertMember" parameterType="gu.member.MemberVO" >
        INSERT INTO TBL_MEMBER(ID, PASSWORD, NAME, NICK_NAME, EMAIL, REG_DTTM)
        VALUES (#{id}, #{password}, #{name}, #{nick_name},#{email},NOW())
    </insert> 
    
<!--회원정보 수정 -->
    <update id="updateMember" parameterType="String"> 
        UPDATE TBL_MEMBER
           SET   password = #{password}
           	   , name =	#{name}
           	   , nick_name = #{nick_name}#
           	   , email = #{email}
           	   , CHG_DTTM = NOW()
         WHERE ID = #{id} 
    </update>     
    
    
<!--아이디 갯수 체크 -->    
    <select id="checkID" resultType="String">
        SELECT COUNT(*)
          FROM TBL_MEMBER
         WHERE 1=1
           AND ID=#{id}
    </select> 

<!--회원사진 업로드 입력 -->  
	<insert id="insertImage" parameterType="gu.common.ImageVO">
    INSERT INTO TBL_IMAGE 
     	(
         IMGNO,
    	 FILENAME,
    	 FILESIZE,
    	 REG_ID, 
         REG_DTTM, 
         CHG_ID, 
         CHG_DTTM)
        VALUES
        (
       	 (SELECT IFNULL(MAX(IMGNO),0)+1 FROM TBL_IMAGE A),
         #{filename},
         #{filesize},
         #{parentPK},
  		 NOW(),
  		 NULL,
  		 NULL   
    	)   
	</insert>
	
<!--회원사진 업로드 수정 -->  
	<update id="updateImage" parameterType="gu.common.ImageVO">
    UPDATE TBL_IMAGE 
       SET   FILENAME = #{filename}
       		,FILESIZE = #{filesize}
       		,CHG_DTTM =  NOW()
     WHERE 1=1
       AND REG_ID = #{parentPK}	
	</update>	

</mapper>    